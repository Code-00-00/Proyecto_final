<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil - Sabores Unidos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="light-mode">
  <!-- Header -->
  <header>
    <a href="{{ url_for('index') }}" class="logo">
      <span class="logo-icon">SU</span>
      <span>Sabores Unidos</span>
    </a>
    <nav>
      <ul>
        <li><a href="{{ url_for('index') }}">Inicio</a></li>
        <li><a href="#">Restaurantes</a></li>
        <li><a href="#">Sobre Nosotros</a></li>
        <li><a href="#">Contacto</a></li>
      </ul>
    </nav>
    <div class="auth-buttons">
      <button class="theme-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
      <a href="{{ url_for('profile') }}" class="btn btn-outline" style="display: flex; align-items: center; gap: 0.5rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        Perfil
      </a>
      <a href="{{ url_for('logout') }}" class="btn btn-primary">Cerrar sesión</a>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container" style="margin-top: 2rem;">
    <h1 class="section-title">Mi Perfil</h1>
    
    <div style="display: grid; grid-template-columns: 1fr 3fr; gap: 2rem;">
      <!-- Panel lateral -->
      <div style="background-color: var(--card-bg); border-radius: var(--radius); padding: 2rem; box-shadow: var(--shadow);">
        <div style="text-align: center; margin-bottom: 2rem;">
          <div style="width: 100px; height: 100px; background-color: var(--primary); border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: bold;">
            {{ user.nombre[0] }}{{ user.apellido[0] }}
          </div>
          <h2 style="margin-bottom: 0.5rem;">{{ user.nombre }} {{ user.apellido }}</h2>
          <p style="color: #666;">Miembro desde {{ user.fecha_registro }}</p>
        </div>
        
        <div style="border-top: 1px solid var(--border); padding-top: 1rem;">
          <h3 style="margin-bottom: 1rem; color: var(--primary);">Información de Contacto</h3>
          <p><strong>📧 Email:</strong> {{ user.email }}</p>
          <p><strong>📱 Teléfono:</strong> {{ user.telefono or 'No especificado' }}</p>
          <p><strong>📍 Dirección:</strong> {{ user.direccion or 'No especificada' }}</p>
        </div>
      </div>
      
      <!-- Contenido principal -->
      <div>
        <!-- Favoritos -->
        <div style="background-color: var(--card-bg); border-radius: var(--radius); padding: 2rem; margin-bottom: 2rem; box-shadow: var(--shadow);">
          <h2 style="margin-bottom: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 0.5rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            Restaurantes Favoritos
          </h2>
          
          <div id="favoritesContainer">
            {% if favorite_restaurantes %}
              <div class="restaurants-grid">
                {% for restaurante in favorite_restaurantes %}
                <div class="restaurant-card" onclick="openRestaurantDetail({{ restaurante.id }})" style="cursor: pointer;">
                  <div class="restaurant-header">
                    <img src="{{ url_for('static', filename='images/italiano.jpg') }}" alt="{{ restaurante.nombre }}">
                    <div class="rating">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                      </svg>
                      {{ restaurante.rating }}
                    </div>
                  </div>
                  <div class="restaurant-body">
                    <div class="restaurant-name">{{ restaurante.nombre }}</div>
                    <div class="cuisine-tags">
                      {% for cocina in restaurante.cocina %}
                      <span class="cuisine-tag">{{ cocina | title }}</span>
                      {% endfor %}
                    </div>
                    <div class="restaurant-info">
                      <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                          <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        {{ restaurante.distancia }}
                      </span>
                      <span>{{ restaurante.precio }}</span>
                    </div>
                    <div style="margin-top: 1rem;">
                      <button class="btn btn-primary" style="width: 100%;" onclick="event.stopPropagation(); openReservationModal({{ restaurante.id }}, '{{ restaurante.nombre }}')">
                        Reservar Mesa
                      </button>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <p style="text-align: center; color: #666;">No tienes restaurantes favoritos aún.</p>
            {% endif %}
          </div>
        </div>
        
        <!-- Reservas -->
        <div style="background-color: var(--card-bg); border-radius: var(--radius); padding: 2rem; box-shadow: var(--shadow);">
          <h2 style="margin-bottom: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 0.5rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            Mis Reservas
          </h2>
          
          <div id="reservationsContainer">
            {% if user_reservas %}
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
                {% for reserva in user_reservas %}
                <div style="background-color: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0; color: var(--primary);">{{ reserva.restaurant_name }}</h3>
                    <span style="background-color: {% if reserva.status == 'confirmada' %}#4caf50{% elif reserva.status == 'cancelada' %}#f44336{% else %}#ff9800{% endif %}; color: white; padding: 0.2rem 0.5rem; border-radius: 20px; font-size: 0.8rem;">
                      {{ reserva.status | title }}
                    </span>
                  </div>
                  <p style="margin: 0.5rem 0;"><strong>📅 Fecha:</strong> {{ reserva.date }}</p>
                  <p style="margin: 0.5rem 0;"><strong>🕐 Hora:</strong> {{ reserva.time }}</p>
                  <p style="margin: 0.5rem 0;"><strong>👥 Personas:</strong> {{ reserva.guests }}</p>
                  {% if reserva.special_requests %}
                  <p style="margin: 0.5rem 0;"><strong>📝 Notas:</strong> {{ reserva.special_requests }}</p>
                  {% endif %}
                  <p style="margin: 0.5rem 0; font-size: 0.8rem; color: #666;">Reservado: {{ reserva.created_at }}</p>
                  
                  {% if reserva.status == 'confirmada' %}
                  <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button class="btn btn-outline" style="flex: 1; padding: 0.5rem;" onclick="openRestaurantDetail({{ reserva.restaurant_id }})">
                      Ver Restaurante
                    </button>
                    <button class="btn btn-primary" style="flex: 1; padding: 0.5rem; background-color: #f44336; border-color: #f44336;" onclick="cancelReservation({{ reserva.id }})">
                      Cancelar
                    </button>
                  </div>
                  {% endif %}
                </div>
                {% endfor %}
              </div>
            {% else %}
              <p style="text-align: center; color: #666;">No tienes reservas aún.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  <script>
    // Función para cancelar reserva
    function cancelReservation(reservationId) {
      if (confirm('¿Estás seguro de que quieres cancelar esta reserva?')) {
        fetch(`/cancel_reservation/${reservationId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showMessage(data.message, 'success');
            // Recargar la página para mostrar cambios
            setTimeout(() => location.reload(), 1500);
          } else {
            showMessage('Error: ' + data.error, 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showMessage('Error al cancelar la reserva', 'error');
        });
      }
    }

    // Función para mostrar mensajes
    function showMessage(message, type = 'info') {
      // Crear mensaje flotante
      const messageDiv = document.createElement('div');
      messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        color: white;
        font-weight: 500;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 2000;
        background-color: ${type === 'success' ? '#4caf50' : type === 'error' ? '#d32f2f' : '#1976d2'};
      `;
      messageDiv.textContent = message;
      
      document.body.appendChild(messageDiv);
      
      // Auto-ocultar después de 3 segundos
      setTimeout(() => {
        messageDiv.style.opacity = '0';
        setTimeout(() => messageDiv.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>